---
title: "Brewing Up a Storm"
output: html_notebook
---
### Introduction

```{r}
# load in the libraries
library(tidyverse)
library(dplyr)
library(tidyr)
library(stringi)
library(ggplot2)
library(plotly)
library(plyr)
```

## Analysis

### Read in the data
Read in data from files
```{r}
beer = read.csv("./data/Beers.csv",header = TRUE)
breweries = read.csv("./data/Breweries.csv",header = TRUE)

#display the dataframes
beer
breweries

```


### How many breweries are there in each state?

```{r}

str(breweries) # check that State is a Factor

state_breweies <- breweries %>% group_by(State) %>% tally() # count the number of breweries within a state
unique_state_breweies <- breweries %>% group_by(State) %>% tally(n_distinct(Name)) # check for any duplicates

```

#### Heat Map of Breweies per State

```{r}

```

### Cleaning the data
Prepering/transforming the data into a usable form for analysis, visualization, etc... 
#### Merging Dataframes
Merge beer data with the breweries data. Print the first 6 observations and the last six observations to check the merged file.  
```{r}

attach(beer)
beer[order(Brewery_id),] # sort the data to determine column for merge

# merge on Brewery ID
breweries_named <- rename(breweries, c("Brew_ID"="Brewery_id"))

brewing_beer <- merge(breweries_named,beer,by="Brewery_id", all=TRUE) # outter join

brewed_beer <- rename(brewing_beer, c("Name.x"="Brewery", "Name.y"="Beer")) # rename breweries and beer

head(brewed_beer,6) # show the first 6 rows of data

```

#### Missing Data
Missing data are in columns ABV (62) and IBU (1005) only. 
Cleaning data in multiple options:
1. complete records only
2. replacing NA with the averages of the remainder of the column

```{r}
# selecting only complete cases
which(is.na(brewed_beer)) # determine which rows contain NA
colSums(is.na(brewed_beer)) # summary of the number of NA in each column
completed_beer <- brewed_beer[complete.cases(brewed_beer), ] # df with only complete records

# replacing NA with averages
averaged_beer <- brewed_beer # make a duplicate of the original df to manipulate
averaged_beer$ABV <- mean(averaged_beer$ABV, na.rm = TRUE)
averaged_beer$IBU <- mean(averaged_beer$IBU, na.rm = TRUE)
colSums(is.na(averaged_beer))

```

### Median Alcohol Content
Median of Alcohol by Volume and Bitterness by State
```{r}
# group by state, get median of ABV, IBU
medians <- as.data.frame(aggregate(completed_beer[,c(7,8)], by=list(completed_beer$State), FUN=median)) 
median_df <- rename(medians, c("Group.1"="State")) # rename the column to State

median_graph <- median_df %>% ggplot(aes(x = ABV, y = IBU, color=State)) + geom_point() + ggtitle("Median Alcohol Content and Bitterness by State") # plot scatter plot

ABV_bar <-ggplot(data=median_df, aes(x = State, y = ABV, fill = State)) +
  geom_bar(stat="identity", width = 0.75) + theme(axis.text.x = element_text(angle = 90, hjust = 1)) + ggtitle("Median ABV by State")
ggplotly(ABV_bar)

IBU_bar <-ggplot(data=median_df, aes(x = State, y = IBU, fill = State)) +
  geom_bar(stat="identity", width = 0.75) + theme(axis.text.x = element_text(angle = 90, hjust = 1)) + ggtitle("Median IBU by State")
ggplotly(IBU_bar)

```
### Max ABV and IBU
Which state has the maximum alcoholic (ABV) beer? Which state has the most bitter (IBU) beer?
```{r}
# find the max ABV and IBU from each state
maximums <- as.data.frame(aggregate(completed_beer[,c(7,8)], by=list(completed_beer$State), FUN=max))
max_df <- rename(maximums, c("Group.1"="State")) # rename the column to State

#find the max ABV and IBU states
max_ABV <- max_df %>% filter(ABV == max(ABV))
max_IBU <- max_df %>% filter(IBU == max(IBU))

max_state <- rbind(max_ABV, max_IBU)
max_state

```

### Summary Statistics
The summary statistics and distribution of the ABV variable.

```{r}
#Creates column representing ABV in percentage which is more user-readable and in-line with how
#ABV is represented by the industry
print("Values below are in percentage (%)")
completed_beer$ABVpercent <- completed_beer$ABV*100 

summary(completed_beer$ABVpercent) #Range, quartiles, and mean of ABV percentage value

cat("Standard deviation: ", sd(completed_beer$ABVpercent)) #Standard deviation of ABV percentage value


```

### Relationship between Bitterness and Alcohol Content
Is there an apparent relationship between the bitterness of the beer and its alcoholic content? Draw a scatter plot.  Make your best judgment of a relationship and EXPLAIN your answer.
```{r}
#Correlation between ABV percentage and IBU; function uses Pearson method as default
cor(x=completed_beer$ABVpercent, y=completed_beer$IBU)

#Visualizations between ABV percentage and IBU
ggplot(data=completed_beer, mapping=aes(x= IBU, y= ABVpercent, position_jitter())) + geom_point()

ggplot(data=completed_beer, mapping=aes(x= ABVpercent, y= IBU, position_jitter())) + geom_point()
```

### IPAs vs. Ales
Budweiser would also like to investigate the difference with respect to IBU and ABV between IPAs (India Pale Ales) and other types of Ale (any beer with “Ale” in its name other than IPA).  You decide to use KNN classification to investigate this relationship.  Provide statistical evidence one way or the other. You can of course assume your audience is comfortable with percentages … KNN is very easy to understand conceptually.

In addition, while you have decided to use KNN to investigate this relationship (KNN is required) you may also feel free to supplement your response to this question with any other methods or techniques you have learned.  Creativity and alternative solutions are always encouraged.  
```{r}

```

### Additional inferences
Knock their socks off!  Find one other useful inference from the data that you feel Budweiser may be able to find value in.  You must convince them why it is important and back up your conviction with appropriate statistical evidence. 
```{r}

```










